+++
categories = ["programming"]
date = "2016-11-30T17:37:43+09:00"
slug = "which-case-use-sqlite-database"
tags = ["SQLite"]
title = "どういったケースのときにSQLiteを選択すべきか"
type = "programming"
+++

静的サイトジェネレーターをつくっていて、クライアントとなるアプリの設定ファイルやバックアップファイルをどうやって管理しようかと考えていて、SQLiteという選択肢が良さそうな気がしてきたので、考察を書いてみます。

最終的には静的サイトジェネレーターの使用データを蓄積して人工知能にくわせるというのが目的なので、定期的にユーザーデータを取得し続ける必要がある。本当はローカル完結でいいんだけど、Webを革新していくために人工知能用のデータが必要なのです。だから、そこらへんのスケールを考慮して結論を出してみました。

結論を先に述べます。各ユーザーのデータはSQLiteで管理し、そのSQLiteのデータを定期的にサーバーへプッシュする。サーバー側のビッグデータはMySQLやPostgreSQLに変換してビッグデータとして扱う。これでいこうと思います。

さて、最近ではMemSQLなどのDBなどが高速に動作するとして注目されていたりしますが、直近のサービスで使用するにはまだ躊躇してしまう印象です。そこで、最近よく使われるDBのなかで、書き込みや読み込み速度がある程度早くて、簡単に取り扱うことができるものを選ぼうと思い、ググって調べてSQLiteにたどり着いたわけです。

Ruby on Railsなど、フレームワークのデフォルトDBとして利用されるケースもまぁまぁあると思うのですが、「小規模に向く」みたいなことが頭によぎって、サービスを拡大させたい頭のみなさんはMySQLなどの他のDBに差し替えて使用しているケースも多い印象です。それは気持ち的にわかるのですが、果たしてSQLiteはどの程度のデータを扱う場合に使えるのでしょうか？小規模とは？というところを調べてみました。実際は多角的に判断すべきであるとは思いつつ、とりあえずわかりやすい指標として、数量系について調べてみました。

## SQLiteの全体サイズの上限は32TB

列数は32767、データサイズは1GBが上限とのこと。比較としてMySQLは全体サイズ無制限、データサイズ無制限ということで、やっぱりビッグデータを扱う場合に有力な候補となりえるみたいですね。ところで、全体サイズとデータサイズの違いは？と思いました。ちょっと違いがわからないですね。軽く調べてもわからないのであきらめました。このデータサイズは１つのDBの容量でしょうか？そう過程すると、1GBなので、全角日本語で5億6000万文字程度とのことで、まぁまぁの量が入りますね。画像を扱ってくる全然違う気がしますが、とりあえず設定ファイル用途としてはしばらくいけそうです。

## なぜ、YAMLやTOML、JSONを使わないのか？

もちろん選択肢として考えました。特にJSONはアプリケーションから呼び出したりするのにもいいし、Pjax、Ajaxとの相性も良さそうなので利用は悩みました。ただ、データを永続化し、且つ整理しながら蓄積していくためには設定ファイルのフォーマットよりはデータベースでやり取りしたほうが効率が良いと考え、SQLiteを選択しました。本当はもっとシンプルなフォーマットを自分でつくっちゃえばいいんでしょうけど、データのやりとりの調整に時間がかかってしまいそうなので、すでにあるものでやったほうが良いのだろうと思いあきらめました。

## SQLiteはMac標準で入ってるというのも選んだポイント

SQLite3はMacにデフォルトで入っているようです。（どのバージョンからかは調べていませんが。。）最初のクライアントはmacOSアプリなので、Macユーザーを対象にすると、割りと障壁を回避できそうだなと思い、これもSQLiteを選んだ理由の一つです。Core Dataとして扱う手もあると思いますが、つくっている静的サイトジェネレーターからたとえばWordpress用のデータにエクスポートする、あるいは逆にインポートすると考えたときに、データが切り分けられているのは何かとメリットがあると思い、データベースでの管理を重要視しました。

プロダクト的にメインフィールドがローカルというところもあるので、扱いやすさを優先しても良いかなと思いました。クラウドサービスだとセキュリティーとかいろいろ考えなきゃいけないと思いますが、とりあえずは良しとしましょう。SQLiteはシンプルにファイルなのがいいですね、保存製に優れている点も魅力です。MySQLのようにそもそもデータにエクスポートする必要がないみたいなので、シンプルにしたいボクの思考にピッタリとはまりました。

逆に、RailsなどがなぜSQLiteをデフォルトDBにしたのかも意図がわかりました。「細かいことを気にせずたのしもうぜ！」そういう意図が垣間見えます。フレームワークの設計意図を考えるとそのフレームワークの思想も反映されていたりするということに気づき、おもしろいなーと改めて思いました。

気が向いたらSQLiteをつなぎこむコードなんかも公開していきたいですが、とりあえずは考察ということでまた。

